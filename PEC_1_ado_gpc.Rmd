---
title: "PEC 1. Análisis de datos ómicos."
author: "Guillermo Prol Castelo"
date: "11/2/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# I. El estudio (cuestiones a responder).

## I.1. Descripción del estudio.

## I.2. Librerías, directorios y funciones.

Comenzamos cargando todas las librerías que nos harán falta a lo largo del análisis.

```{r}
suppressMessages( library(Biobase) )
suppressMessages( library(GEOquery) )
suppressMessages( library(genefilter) )
suppressMessages( library(oligo) )
suppressMessages( library(arrayQualityMetrics) )
suppressMessages( library(ggplot2) )
suppressMessages( library(ggrepel) )
suppressMessages( library(gmodels) )
```

Para facilitar el estudio, trabajaremos en un directorio escogido por nosotros y cuya localización se asigna a la variable `workingDir`. Los datos se copiarán en un subdirectorio del anterior denominado `data`, que se almacenará en la variable `dataDir` y los resultados se almacenarán en un directorio `results`, cuyo nombre se almacenará en la variable `resultsDir`.

```{r}
workingDir <- getwd()
# Creamos los directorios de datos y resultados:
system("mkdir data")
system("mkdir results")
system("mkdir celfiles")
# Los asignamos a variables:
dataDir <-file.path(workingDir, "data")
resultsDir <- file.path(workingDir, "results")
celfilesDir <- file.path(workingDir,"celfiles")
# Seleccionamos el directorio de trabajo:
setwd(workingDir)
```

Cargamos las funciones necesarias para el análisis.

```{r}
# Declaramos el directorio de funciones:
functionsDir <- file.path(workingDir, "functions/")
# Cargamos la función plotPCA.R
source(file.path(functionsDir,"plotPCA.R"))
```


# II. Análisis.

## II.1. Obtención y lectura de los datos.




```{r}
gse <- getGEO("GSE3311", GSEMatrix = T, destdir = dataDir)
# Descargamos los datos ('raw data') en la carpeta de datos:
a <- getGEOSuppFiles("GSE3311",makeDirectory = F, baseDir = dataDir)
```



```{r}
# get info from gse
filedata <- pData(phenoData(gse[[1]]))
sampleNames <- rownames(filedata)
# get dataframe with .CEL files names:
file_to_txt <- data.frame(file_name=paste(sampleNames,'.CEL',sep=''),dataDir)
# Creamos una tabla con las muestras seleccionadas:
write.table(file_to_txt, 
            file=file.path(dataDir, "targets.txt"),
            sep="\t", 
            row.names=FALSE, 
            quote=FALSE)
```

```{r}
# Directory the .tar was saved to:
unpackDir <-  celfilesDir
# Decompress .tar file:
untar(file.path(dataDir, 'GSE3311_RAW.tar'), exdir = celfilesDir)
# Delete .tar file:
#file.remove(file.path(unpackDir, 'GSE18198_RAW.tar'))

# Decompress all .gz files in our directory:
for (i in list.files(unpackDir)) {
  gunzip(file.path(unpackDir, i))
}
```


## II.2. Exploración, control de calidad y normalización.


### II.2.1. Control de calidad.


### II.2.2. Normalización y filtraje.



## II.3. Selección de genes diferencialmente expresados.


### II.3.1. Análisis basado en modelos lineales.


### II.3.2. Comparaciones múltiples.


### II.3.3. Anotación de resultados.


### II.3.4. Visualización de los perfiles de expresión.



# III. Resultados y discusión.














